ControlMaster auto
ControlPath /tmp/ssh_mux_%h_%p_%r
ControlPersist 15m

## OnDemand configuration
## For more information, see: https://sdog.jira.com/wiki/display/JST/SSH+Config+File 

ServerAliveInterval 300
 
## Contegix Enterprise Hosted (Legacy) (experimental!)
# Only required for SSHing to *.onjira.com and *.onconfluence.com
Host atlassian-support-jump.managed.contegix.com cjump
    Hostname atlassian-support-jump.managed.contegix.com
    ForwardAgent yes
Host *.onjira.com *.onconfluence.com
    User atlassian
    ProxyCommand nohup ssh -Ax cjump nc %h %p

# Unicorn ASH1
Host manager-0.ash1.uc-inf.net man0-ash1
    Hostname manager-0.ash1.uc-inf.net
    ForwardAgent yes
Host manager-1.ash1.uc-inf.net man1-ash1
    Hostname manager-1.ash1.uc-inf.net
    ForwardAgent yes
Host jump1.ash1.uc-inf.net jump1-ash1
    Hostname jump1.ash1.uc-inf.net
    ForwardAgent yes
Host jump2.ash1.uc-inf.net jump2-ash1
    Hostname jump2.ash1.uc-inf.net
    ForwardAgent yes

# Syd1
Host jump1.syd1.uc-inf.net jump1-syd1
     Hostname jump1.syd1.uc-inf.net
     ForwardAgent yes
Host manager-0.syd1.uc-inf.net man0-syd1
     Hostname manager-0.syd1.uc-inf.net
     ForwardAgent yes
Host manager-1.syd1.uc-inf.net man1-syd1
     Hostname manager-1.syd1.uc-inf.net
     ForwardAgent yes
 
# Proxy command
Host *.jira.com *.jira-dev.com *.atlassian.net
     User root
     ProxyCommand nohup ssh -Ax $(dig +short %h | awk '/^59.167.29./ { print "jump1-syd1" } /^207.223.247./ { print "jump1-uc1" } /^131.103./ { print "jump1-ash1" } END { print "localhost" }' | head -n 1) nc $(dig +short %h | awk '/^(59.167|207.223.247|131.103)./ { print "%h.internal" } END { print "%h" }' | head -n 1) %p
 
# Unicorn infrastructure instances
# Ashburn
Host *.ash1.uc-inf.net.internal
  ProxyCommand ssh -A -C jump1-ash1 nc %h 22
  User root
  ForwardAgent yes

# Syd1
Host *.syd1.uc-inf.net.internal
  ProxyCommand ssh -A -C jump1-syd1 nc %h 22
  User root
  ForwardAgent yes

# Your own dev instance on Unicorn
Host unicorn
  Hostname %u.jira-dev.com
  User root
  ProxyCommand ssh -A -C jump1-syd1 nc %h 22
  StrictHostKeyChecking no
